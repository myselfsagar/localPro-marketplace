<%- include('../../partials/header') %> <%-
include('../../partials/_messages')%>

<main class="provider-detail-container">
  <div class="profile-header">
    <img
      src="<%= provider.profileImageUrl || '/images/default-profile.png' %>"
      alt="<%= provider.businessName %> Profile"
      style="
        max-width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 50%;
        margin-bottom: 1rem;
      "
    />
    <h1><%= provider.businessName %></h1>
    <p>
      <strong>Average Rating:</strong> <%= averageRating %> ★ (<%= reviewCount
      %> reviews)
    </p>
    <p>
      <strong>Proprietor:</strong> <%= provider.User.firstName %> <%=
      provider.User.lastName %>
    </p>
    <p><strong>Location:</strong> <%= provider.location %></p>
  </div>

  <div class="profile-bio">
    <h2>About Us</h2>
    <p><%= provider.bio %></p>
  </div>

  <hr />

  <div class="services-section">
    <h2>Services Offered</h2>
    <% if (provider.Services && provider.Services.length > 0) { %>
    <div class="service-list">
      <% provider.Services.forEach(service => { %>
      <div class="service-item">
        <h3><%= service.name %></h3>
        <img
          src="<%= service.imageUrl || '/images/default-service.png' %>"
          alt="<%= service.name %>"
          style="
            max-width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 0.5rem;
          "
        />
        <p class="service-price">$<%= service.price %></p>
        <p><%= service.description %></p>

        <% if (user) { %>
        <a href="/book/new/<%= service.id %>" class="btn">Book This Service</a>
        <% } %>
      </div>
      <% }) %>
    </div>

    <% if (!user) { %>
    <p>
      <strong
        ><a href="/login">Login</a> or <a href="/signup">Sign Up</a> to book
        services.</strong
      >
    </p>
    <% } %> <% } else { %>
    <p>This provider has not listed any services yet.</p>
    <% } %>
  </div>

  <hr />

  <div class="reviews-section">
    <h2>Customer Reviews</h2>
    <% if (reviews.length > 0) { %> <% reviews.forEach(review => { %>
    <div class="review-card">
      <p>
        <strong>Rating:</strong>
        <%= '★'.repeat(review.rating) %><span style="color: #ddd"
          ><%= '★'.repeat(5 - review.rating) %></span
        >
      </p>
      <p>"<%= review.comment %>"</p>
      <small
        >- <%= review.customerName %>, <%= new
        Date(review.createdAt).toLocaleDateString() %></small
      >
    </div>
    <% }) %> <% } else { %>
    <p>This provider has no reviews yet.</p>
    <% } %>
  </div>
</main>

<%- include('../../partials/footer') %>
